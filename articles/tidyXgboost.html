<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>tidy xgboost • autostats</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="tidy xgboost">
<meta property="og:description" content="autostats">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-KQ5VTRKQF1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KQ5VTRKQF1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">autostats</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/autostats.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tidyXgboost.html">tidyXgboost</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Harrison4192/autostats" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://harrison4192.github.io/TidyConsultant/" class="external-link">TC</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>tidy xgboost</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Harrison4192/autostats/blob/HEAD/vignettes/tidyXgboost.Rmd" class="external-link"><code>vignettes/tidyXgboost.Rmd</code></a></small>
      <div class="hidden name"><code>tidyXgboost.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://harrison4192.github.io/autostats/" class="external-link">autostats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/workflows" class="external-link">workflows</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tune.tidymodels.org/" class="external-link">tune</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsample.tidymodels.org" class="external-link">rsample</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/hardhat" class="external-link">hardhat</a></span><span class="op">)</span></span></code></pre></div>
<p><code>autostats</code> provides convenient wrappers for modeling,
visualizing, and predicting using a tidy workflow. The emphasis is on
rapid iteration and quick results using an intuitive interface based off
the <code>tibble</code> and <code>tidy_formula</code>.</p>
<div class="section level2">
<h2 id="prepare-data">Prepare data<a class="anchor" aria-label="anchor" href="#prepare-data"></a>
</h2>
<p>Set up the iris data set for modeling. Create dummies and any new
columns before making the formula. This way the same formula can be use
throughout the modeling and prediction process.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">34</span><span class="op">)</span></span>
<span></span>
<span> <span class="va">iris</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">framecleaner</span><span class="fu">::</span><span class="fu"><a href="https://harrison4192.github.io/framecleaner/reference/create_dummies.html" class="external-link">create_dummies</a></span><span class="op">(</span>remove_first_dummy  <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">iris1</span></span>
<span><span class="co">#&gt; 1 column(s) have become 2 dummy columns</span></span>
<span></span>
<span> <span class="va">iris1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span> <span class="fu"><a href="../reference/tidy_formula.html">tidy_formula</a></span><span class="op">(</span>target <span class="op">=</span> <span class="va">Petal.Length</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">petal_form</span></span>
<span> </span>
<span> <span class="va">petal_form</span></span>
<span><span class="co">#&gt; Petal.Length ~ Sepal.Length + Sepal.Width + Petal.Width + Species_versicolor + </span></span>
<span><span class="co">#&gt;     Species_virginica</span></span>
<span><span class="co">#&gt; &lt;environment: 0x55b3bd363cc0&gt;</span></span></code></pre></div>
<p>Use the rsample package to split into train and validation sets.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris1</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">initial_split</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">iris_split</span></span>
<span></span>
<span><span class="va">iris_split</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/as.data.frame.rsplit.html" class="external-link">analysis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">iris_train</span></span>
<span></span>
<span><span class="va">iris_split</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/as.data.frame.rsplit.html" class="external-link">assessment</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">iris_val</span></span>
<span></span>
<span><span class="va">iris_split</span></span>
<span><span class="co">#&gt; &lt;Training/Testing/Total&gt;</span></span>
<span><span class="co">#&gt; &lt;112/38/150&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-boosting-models-and-visualize">Fit boosting models and visualize<a class="anchor" aria-label="anchor" href="#fit-boosting-models-and-visualize"></a>
</h2>
<p>Fit models to the training set using the formula to predict
<code>Petal.Length</code>. Variable importance using gain for each
<code>xgboost</code> model can be visualized.</p>
<div class="section level3">
<h3 id="xgboost-with-bayesian-hyperparameter-optimization">xgboost with bayesian hyperparameter optimization<a class="anchor" aria-label="anchor" href="#xgboost-with-bayesian-hyperparameter-optimization"></a>
</h3>
<p><code>auto_tune_xgboost</code> returns a workflow object with tuned
parameters and requires some postprocessing to get a traind
<code>xgb.Booster</code> object like <code>tidy_xgboost</code>. Tuning
iterations set to <code>1</code> just so the vignette builds quickly.
Default is <code>n_iter = 100</code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_train</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/auto_tune_xgboost.html">auto_tune_xgboost</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">petal_form</span>, n_iter <span class="op">=</span> <span class="fl">7L</span>, tune_method <span class="op">=</span> <span class="st">"bayes"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">xgb_tuned_bayes</span></span>
<span></span>
<span><span class="va">xgb_tuned_bayes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">iris_train</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">hardhat</span><span class="fu">::</span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_fit_engine</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">xgb_tuned_fit_bayes</span></span>
<span></span>
<span><span class="va">xgb_tuned_fit_bayes</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/visualize_model.html">visualize_model</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="xgboost-with-grid-search-hyperparameter-optimization">xgboost with grid search hyperparameter optimization<a class="anchor" aria-label="anchor" href="#xgboost-with-grid-search-hyperparameter-optimization"></a>
</h3>
<p><code>xgboost</code> also can be tuned using a grid that is created
internally using <code><a href="https://dials.tidymodels.org/reference/grid_max_entropy.html" class="external-link">dials::grid_max_entropy</a></code>. The
<code>n_iter</code> parameter is passed to <code>grid_size</code>.
Parallelization is highly effective in this method, so the default
argument <code>parallel = TRUE</code> is recommended.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_train</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/auto_tune_xgboost.html">auto_tune_xgboost</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">petal_form</span>, n_iter <span class="op">=</span> <span class="fl">5L</span>,trees <span class="op">=</span> <span class="fl">20L</span>, loss_reduction <span class="op">=</span> <span class="fl">2</span>, mtry <span class="op">=</span> <span class="fl">.5</span>, tune_method <span class="op">=</span> <span class="st">"grid"</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">xgb_tuned_grid</span></span>
<span></span>
<span><span class="va">xgb_tuned_grid</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">iris_train</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html" class="external-link">extract_fit_engine</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">xgb_tuned_fit_grid</span></span>
<span></span>
<span><span class="va">xgb_tuned_fit_grid</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/visualize_model.html">visualize_model</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="xgboost-with-default-parameters">xgboost with default parameters<a class="anchor" aria-label="anchor" href="#xgboost-with-default-parameters"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_train</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/tidy_xgboost.html">tidy_xgboost</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">petal_form</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">xgb_base</span></span>
<span><span class="co">#&gt; accuracy tested on a validation set</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   .metric .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ccc         0.975</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> rmse        0.375</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> rsq         0.953</span></span></code></pre></div>
<p><img src="tidyXgboost_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="xgboost-with-hand-picked-parameters">xgboost with hand-picked parameters<a class="anchor" aria-label="anchor" href="#xgboost-with-hand-picked-parameters"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_train</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/tidy_xgboost.html">tidy_xgboost</a></span><span class="op">(</span><span class="va">petal_form</span>, </span>
<span>               trees <span class="op">=</span> <span class="fl">250L</span>, </span>
<span>               tree_depth <span class="op">=</span> <span class="fl">3L</span>, </span>
<span>               sample_size <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>               mtry <span class="op">=</span> <span class="fl">.5</span>,</span>
<span>               min_n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">xgb_opt</span></span>
<span><span class="co">#&gt; accuracy tested on a validation set</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   .metric .estimate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ccc         0.979</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> rmse        0.347</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> rsq         0.964</span></span></code></pre></div>
<p><img src="tidyXgboost_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="predict-on-validation-set">predict on validation set<a class="anchor" aria-label="anchor" href="#predict-on-validation-set"></a>
</h2>
<div class="section level3">
<h3 id="make-predictions">make predictions<a class="anchor" aria-label="anchor" href="#make-predictions"></a>
</h3>
<p>Predictions are iteratively added to the validation data frame. The
name of the column is automatically created using the models name and
the prediction target.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">xgb_base</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/tidy_predict.html">tidy_predict</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">iris_val</span>, form <span class="op">=</span> <span class="va">petal_form</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">iris_val2</span></span>
<span><span class="co">#&gt; created the following column: Petal.Length_preds_Table</span></span>
<span></span>
<span><span class="va">xgb_opt</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/tidy_predict.html">tidy_predict</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">iris_val2</span>, <span class="va">petal_form</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">iris_val3</span></span>
<span><span class="co">#&gt; created the following column: Petal.Length_preds_Table</span></span>
<span></span>
<span></span>
<span><span class="va">iris_val3</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Sepal.Length"             "Sepal.Width"             </span></span>
<span><span class="co">#&gt; [3] "Petal.Length"             "Petal.Width"             </span></span>
<span><span class="co">#&gt; [5] "Species_versicolor"       "Species_virginica"       </span></span>
<span><span class="co">#&gt; [7] "Petal.Length_preds_Table"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="predictions-with-eval_preds">predictions with eval_preds<a class="anchor" aria-label="anchor" href="#predictions-with-eval_preds"></a>
</h3>
<p>Instead of evaluationg these prediction 1 by 1, This step is
automated with <code>eval_preds</code>. This function is specifically
designed to evaluate predicted columns with names given from
<code>tidy_predict</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_val3</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/eval_preds.html">eval_preds</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">#&gt;   .metric .estimator .estimate model target      </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ccc     standard       0.984 Table Petal.Length</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> rmse    standard       0.312 Table Petal.Length</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> rsq     standard       0.972 Table Petal.Length</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="get-shapley-values">get shapley values<a class="anchor" aria-label="anchor" href="#get-shapley-values"></a>
</h2>
<p><code>tidy_shap</code> has similar syntax to
<code>tidy_predict</code> and can be used to get shapley values from
<code>xgboost</code> models on a validation set.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xgb_base</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/tidy_shap.html">tidy_shap</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">iris_val</span>, form <span class="op">=</span> <span class="va">petal_form</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">shap_list</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shap_list</span><span class="op">$</span><span class="va">shap_tbl</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 38 × 5</span></span></span>
<span><span class="co">#&gt;    Sepal.Length Sepal.Width Petal.Width Species_versicolor Species_virginica</span></span>
<span><span class="co">#&gt;           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>       -<span style="color: #BB0000;">0.236</span>     -<span style="color: #BB0000;">0.070</span><span style="color: #BB0000; text-decoration: underline;">0</span>       -<span style="color: #BB0000;">1.97</span>             0.097<span style="text-decoration: underline;">0</span>          0.000<span style="text-decoration: underline;">452</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>       -<span style="color: #BB0000;">0.284</span>     -<span style="color: #BB0000;">0.076</span><span style="color: #BB0000; text-decoration: underline;">4</span>       -<span style="color: #BB0000;">2.02</span>             0.095<span style="text-decoration: underline;">4</span>          0.000<span style="text-decoration: underline;">395</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>       -<span style="color: #BB0000;">0.118</span>     -<span style="color: #BB0000;">0.096</span><span style="color: #BB0000; text-decoration: underline;">9</span>       -<span style="color: #BB0000;">2.04</span>             0.097<span style="text-decoration: underline;">0</span>          0.001<span style="text-decoration: underline;">37</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>       -<span style="color: #BB0000;">0.244</span>     -<span style="color: #BB0000;">0.077</span><span style="color: #BB0000; text-decoration: underline;">8</span>       -<span style="color: #BB0000;">1.99</span>             0.097<span style="text-decoration: underline;">0</span>          0.000<span style="text-decoration: underline;">452</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>       -<span style="color: #BB0000;">0.143</span>     -<span style="color: #BB0000;">0.059</span><span style="color: #BB0000; text-decoration: underline;">5</span>       -<span style="color: #BB0000;">2.08</span>             0.097<span style="text-decoration: underline;">0</span>          0.000<span style="text-decoration: underline;">452</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>       -<span style="color: #BB0000;">0.281</span>     -<span style="color: #BB0000;">0.062</span><span style="color: #BB0000; text-decoration: underline;">7</span>       -<span style="color: #BB0000;">2.01</span>             0.097<span style="text-decoration: underline;">0</span>          0.000<span style="text-decoration: underline;">845</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>       -<span style="color: #BB0000;">0.228</span>     -<span style="color: #BB0000;">0.039</span><span style="color: #BB0000; text-decoration: underline;">5</span>       -<span style="color: #BB0000;">1.90</span>             0.097<span style="text-decoration: underline;">0</span>          0.000<span style="text-decoration: underline;">856</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>       -<span style="color: #BB0000;">0.260</span>     -<span style="color: #BB0000;">0.145</span>        -<span style="color: #BB0000;">2.04</span>             0.095<span style="text-decoration: underline;">4</span>          0.000<span style="text-decoration: underline;">351</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>       -<span style="color: #BB0000;">0.223</span>     -<span style="color: #BB0000;">0.090</span><span style="color: #BB0000; text-decoration: underline;">9</span>       -<span style="color: #BB0000;">1.99</span>             0.095<span style="text-decoration: underline;">4</span>          0.000<span style="text-decoration: underline;">395</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>       -<span style="color: #BB0000;">0.281</span>      0.272        -<span style="color: #BB0000;">1.86</span>             0.096<span style="text-decoration: underline;">0</span>         -<span style="color: #BB0000;">0.001</span><span style="color: #BB0000; text-decoration: underline;">04</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 28 more rows</span></span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shap_list</span><span class="op">$</span><span class="va">shap_summary</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 5</span></span></span>
<span><span class="co">#&gt;   name                  cor       var     sum sum_abs</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Petal.Width         0.955 2.29       8.43    53.7  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Sepal.Length        0.809 0.087<span style="text-decoration: underline;">5</span>    -<span style="color: #BB0000;">2.27</span>     7.82 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Species_versicolor -<span style="color: #BB0000;">0.934</span> 0.033<span style="text-decoration: underline;">3</span>     3.33     7.20 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Sepal.Width        -<span style="color: #BB0000;">0.696</span> 0.014<span style="text-decoration: underline;">8</span>     0.310    3.25 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Species_virginica  -<span style="color: #BB0000;">0.326</span> 0.000<span style="text-decoration: underline;">023</span>0 -<span style="color: #BB0000;">0.042</span><span style="color: #BB0000; text-decoration: underline;">7</span>   0.107</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shap_list</span><span class="op">$</span><span class="va">swarmplot</span></span></code></pre></div>
<p><img src="tidyXgboost_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shap_list</span><span class="op">$</span><span class="va">scatterplots</span></span></code></pre></div>
<div class="section level3">
<h3 id="understand-xgboost-with-other-functions-from-the-original-package">understand xgboost with other functions from the original
package<a class="anchor" aria-label="anchor" href="#understand-xgboost-with-other-functions-from-the-original-package"></a>
</h3>
<p>Overfittingin the base config may be related to growing deep
trees.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">xgb_base</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.plot.deepness.html" class="external-link">xgb.plot.deepness</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyXgboost_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">xgb_base</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.plot.deepness.html" class="external-link">xgb.plot.deepness</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="tidyXgboost_files/figure-html/unnamed-chunk-16-1.png" width="700">
Plot the first tree in the model. The small in terminal leaves suggests
overfitting in the base model.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xgb_base</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.plot.tree.html" class="external-link">xgb.plot.tree</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">.</span>, trees <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Harrison Tietze.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
